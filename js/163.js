"use strict";(self["webpackChunkdental_blade"]=self["webpackChunkdental_blade"]||[]).push([[163],{5163:function(e,a,l){l.r(a),l.d(a,{default:function(){return Y}});var t=l(641),o=l(953),i=l(3751),n=l(33),s=l(4335),u=l(4853),r=l(6583);const c=e=>((0,t.Qi)("data-v-b3ff24f6"),e=e(),(0,t.jt)(),e),d={class:"admin-cases"},m=c((()=>(0,t.Lk)("hr",null,null,-1))),v={class:"cases__content"},k={key:0,class:"cases-form"},p={class:"form-item item-images"},g=c((()=>(0,t.Lk)("label",null,"Добавьте изображения кейса:",-1))),f=["src"],h=["checked","onChange"],L={class:"image-upload-form"},b=c((()=>(0,t.Lk)("label",{for:"image-upload"},"Выберите изображение:",-1))),y={key:0,class:"image-preview"},C=c((()=>(0,t.Lk)("h3",null,"Предварительный просмотр:",-1))),w=["src"],_={class:"form-item"},$=c((()=>(0,t.Lk)("label",{for:"case-name"},"Название кейса:",-1))),A={class:"form-item"},x=c((()=>(0,t.Lk)("label",{for:"case-category"},"Категория:",-1))),R={class:"form-item"},E=c((()=>(0,t.Lk)("label",{for:"case-introduction"},"Введение:",-1))),X={class:"form-item"},z=c((()=>(0,t.Lk)("label",{for:"case-diagnos"},"Диагноз:",-1))),F={class:"form-item"},K=c((()=>(0,t.Lk)("label",{for:"case-treatment"},"Лечение:",-1))),U={class:"form-item"},V=c((()=>(0,t.Lk)("label",{for:"case-total-cost"},"Общая стоимость:",-1))),I={class:"form-item"},B=c((()=>(0,t.Lk)("label",{for:"case-slug"},"Slug:",-1))),J={class:"form-item"},N=c((()=>(0,t.Lk)("label",null,"Доктор:",-1))),W=["value"],T={class:"form-item"},D=c((()=>(0,t.Lk)("label",null,"Цены:",-1))),P=["value"],Q={class:"form-actions"},S={key:1},j=["onClick"],H="http://5.35.90.116:8000/cases",M="http://5.35.90.116:8000/images";var q=(0,t.pM)({__name:"index",setup(e){const a=(0,o.KR)([]),l=(0,o.KR)([]),c=(0,o.KR)([]),q=(0,o.KR)(null),G=(0,o.KR)([]),O=(0,o.KR)(null),Y=(0,o.KR)(null),Z=()=>{const e=localStorage.getItem("token");return e||(console.error("Токен отсутствует"),null)},ee=async()=>{try{const e=await s.A.get(H);a.value=e.data}catch(e){console.error("Ошибка при получении кейсов:",e)}},ae=async()=>{try{const e=await s.A.get("http://5.35.90.116:8000/prices");l.value=e.data}catch(e){console.error("Ошибка при получении цен:",e)}},le=async()=>{try{const e=await s.A.get("http://5.35.90.116:8000/doctors");c.value=e.data}catch(e){console.error("Ошибка при получении докторов:",e)}},te=async e=>{const a=Z();try{const l=await s.A.get(`${H}/${e}`,{headers:{Authorization:`Bearer ${a}`}});q.value=l.data,G.value=l.data.price.map((e=>e.id))}catch(l){console.error("Ошибка при получении кейса:",l)}},oe=e=>{te(e.id)},ie=()=>{q.value=null},ne=e=>{const a=e.target;if(a.files&&a.files.length>0){Y.value=a.files[0];const e=new FileReader;e.onload=e=>{O.value=e.target?.result},e.readAsDataURL(Y.value)}},se=async()=>{const e=Z();if(!Y.value)return null;const a=new FormData;a.append("path",Y.value),a.append("isTitle","false");try{const l=await s.A.post(M,a,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});return console.log("Изображение успешно загружено:",l.data),O.value=null,l.data.id}catch(l){return console.error("Ошибка при загрузке изображения:",l),null}},ue=async e=>{const a=Z();if(a)try{const l=q.value?.images||[];await Promise.all(l.map((async l=>{l.id!==e&&await s.A.patch(`http://5.35.90.116:8000/images/${l.id}`,{isTitle:!1},{headers:{Authorization:`Bearer ${a}`}})}))),await s.A.patch(`http://5.35.90.116:8000/images/${e}`,{isTitle:!0},{headers:{Authorization:`Bearer ${a}`}}),console.log(`Титульное изображение обновлено для ID: ${e}`)}catch(l){console.error("Ошибка при обновлении титульного изображения:",l)}},re=async e=>{if(q.value){const l=Z();q.value.images=q.value.images.filter((a=>a.id!==e));try{await s.A.delete(`http://5.35.90.116:8000/images/${e}`,{headers:{Authorization:`Bearer ${l}`}})}catch(a){console.error("Ошибка при удалении изображения с сервера:",a)}}},ce=async()=>{const e=Z();let a=null;if(Y.value&&(a=await se()),q.value){const t={name:q.value.name,category:q.value.category,introduction:q.value.introduction,diagnos:q.value.diagnos,treatment:q.value.treatment,totalCost:q.value.totalCost,slug:q.value.slug,doctor_id:q.value.doctor?.id,price_id:G.value,images_id:[...q.value.images.map((e=>e.id)),a].filter(Boolean)};try{await s.A.put(`${H}/${q.value.id}`,t,{headers:{Authorization:`Bearer ${e}`}}),console.log("Изменения успешно сохранены для кейса:",q.value),ie(),await ee()}catch(l){console.error("Ошибка при сохранении изменений:",l)}}};return(0,t.sV)((()=>{ee(),ae(),le()})),(e,s)=>((0,t.uX)(),(0,t.CE)("section",d,[(0,t.bF)((0,o.R1)(u.D),{tagName:"h2",size:"xl"},{default:(0,t.k6)((()=>[(0,t.eW)("Кейсы клиники")])),_:1}),m,(0,t.Lk)("div",v,[q.value?((0,t.uX)(),(0,t.CE)("form",k,[(0,t.Lk)("div",p,[g,(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(q.value.images,(e=>((0,t.uX)(),(0,t.CE)("li",{key:e.id},[(0,t.Lk)("img",{src:e.path,alt:"Case Image",style:{width:"100px",height:"auto"}},null,8,f),(0,t.Lk)("p",null,[(0,t.eW)("Сделать титульным "),(0,t.Lk)("input",{type:"checkbox",checked:e.isTitle,onChange:a=>ue(e.id)},null,40,h)]),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"red",onClick:a=>re(e.id)},{default:(0,t.k6)((()=>[(0,t.eW)("Удалить")])),_:2},1032,["onClick"])])))),128))]),(0,t.Lk)("div",L,[b,(0,t.Lk)("input",{type:"file",id:"image-upload",onChange:ne,accept:"image/*"},null,32),O.value?((0,t.uX)(),(0,t.CE)("div",y,[C,(0,t.Lk)("img",{src:O.value,alt:"Image Preview",style:{"max-width":"200px","max-height":"200px"}},null,8,w)])):(0,t.Q3)("",!0),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"accent",onClick:se,disabled:!Y.value},{default:(0,t.k6)((()=>[(0,t.eW)("Загрузить изображение")])),_:1},8,["disabled"])])]),(0,t.Lk)("div",_,[$,(0,t.bo)((0,t.Lk)("input",{id:"case-name","onUpdate:modelValue":s[0]||(s[0]=e=>q.value.name=e)},null,512),[[i.Jo,q.value.name]])]),(0,t.Lk)("div",A,[x,(0,t.bo)((0,t.Lk)("input",{id:"case-category","onUpdate:modelValue":s[1]||(s[1]=e=>q.value.category=e)},null,512),[[i.Jo,q.value.category]])]),(0,t.Lk)("div",R,[E,(0,t.bo)((0,t.Lk)("textarea",{id:"case-introduction","onUpdate:modelValue":s[2]||(s[2]=e=>q.value.introduction=e)},null,512),[[i.Jo,q.value.introduction]])]),(0,t.Lk)("div",X,[z,(0,t.bo)((0,t.Lk)("textarea",{id:"case-diagnos","onUpdate:modelValue":s[3]||(s[3]=e=>q.value.diagnos=e)},null,512),[[i.Jo,q.value.diagnos]])]),(0,t.Lk)("div",F,[K,(0,t.bo)((0,t.Lk)("textarea",{id:"case-treatment","onUpdate:modelValue":s[4]||(s[4]=e=>q.value.treatment=e)},null,512),[[i.Jo,q.value.treatment]])]),(0,t.Lk)("div",U,[V,(0,t.bo)((0,t.Lk)("input",{type:"number",id:"case-total-cost","onUpdate:modelValue":s[5]||(s[5]=e=>q.value.totalCost=e)},null,512),[[i.Jo,q.value.totalCost,void 0,{number:!0}]])]),(0,t.Lk)("div",I,[B,(0,t.bo)((0,t.Lk)("input",{id:"case-slug","onUpdate:modelValue":s[6]||(s[6]=e=>q.value.slug=e)},null,512),[[i.Jo,q.value.slug]])]),(0,t.Lk)("div",J,[N,(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":s[7]||(s[7]=e=>q.value.doctor.id=e)},[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(c.value,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.firstName)+" "+(0,n.v_)(e.lastName),9,W)))),128))],512),[[i.u1,q.value.doctor.id]])]),(0,t.Lk)("div",T,[D,((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(l.value,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id},[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":s[8]||(s[8]=e=>G.value=e)},null,8,P),[[i.lH,G.value]]),(0,t.eW)(" "+(0,n.v_)(e.name)+" - "+(0,n.v_)(e.price),1)])))),128))]),(0,t.Lk)("div",Q,[(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"green",onClick:ce},{default:(0,t.k6)((()=>[(0,t.eW)("Сохранить изменения")])),_:1}),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"white",onClick:ie},{default:(0,t.k6)((()=>[(0,t.eW)("Отмена")])),_:1})])])):((0,t.uX)(),(0,t.CE)("ul",S,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.value,(e=>((0,t.uX)(),(0,t.CE)("li",{key:e.id},[(0,t.Lk)("span",{onClick:a=>oe(e)},(0,n.v_)(e.name),9,j)])))),128))]))])]))}}),G=l(6262);const O=(0,G.A)(q,[["__scopeId","data-v-b3ff24f6"]]);var Y=O}}]);
//# sourceMappingURL=163.js.map