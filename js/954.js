"use strict";(self["webpackChunkdental_blade"]=self["webpackChunkdental_blade"]||[]).push([[954],{5954:function(e,a,l){l.r(a),l.d(a,{default:function(){return ae}});var t=l(641),o=l(953),i=l(3751),n=l(33),s=l(4335),u=l(4853),r=l(6583),c=l(2669),d=l(4176);const m=e=>((0,t.Qi)("data-v-c4ad9526"),e=e(),(0,t.jt)(),e),v={class:"admin-cases"},k=m((()=>(0,t.Lk)("hr",null,null,-1))),p={class:"cases__content"},g={key:1,class:"cases-form"},h={class:"form-item item-images"},f=m((()=>(0,t.Lk)("label",null,"Добавьте изображения кейса:",-1))),b=["src"],L=["checked","onChange"],y={class:"image-upload-form"},C=m((()=>(0,t.Lk)("label",{for:"image-upload"},"Выберите изображение:",-1))),_={key:0,class:"image-preview"},w=m((()=>(0,t.Lk)("h3",null,"Предварительный просмотр:",-1))),$=["src"],x={class:"form-item"},A=m((()=>(0,t.Lk)("label",{for:"case-name"},"Название кейса:",-1))),R={class:"form-item"},z=m((()=>(0,t.Lk)("label",{for:"case-category"},"Категория:",-1))),F={class:"form-item"},X=m((()=>(0,t.Lk)("label",{for:"case-introduction"},"Введение:",-1))),E={class:"form-item"},I=m((()=>(0,t.Lk)("label",{for:"case-diagnos"},"Диагноз:",-1))),K={class:"form-item"},U=m((()=>(0,t.Lk)("label",{for:"case-treatment"},"Лечение:",-1))),V={class:"form-item"},W=m((()=>(0,t.Lk)("label",{for:"case-total-cost"},"Общая стоимость:",-1))),N={class:"form-item"},B=m((()=>(0,t.Lk)("label",{for:"case-slug"},"Slug:",-1))),J={class:"form-item"},D=m((()=>(0,t.Lk)("label",null,"Доктор:",-1))),T=["value"],Q={class:"form-item"},P=m((()=>(0,t.Lk)("label",null,"Цены:",-1))),S=["value"],j={class:"form-actions"},H={key:2},M=["onClick"],q=["onClick"],G="http://5.35.90.116:8000/cases",O="http://5.35.90.116:8000/images";var Y=(0,t.pM)({__name:"index",setup(e){const a=(0,o.KR)([]),l=(0,o.KR)([]),m=(0,o.KR)([]),Y=(0,o.KR)(null),Z=(0,o.KR)([]),ee=(0,o.KR)(null),ae=(0,o.KR)(null),le=(0,o.KR)(!1),te=()=>{const e=localStorage.getItem("token");return e||(console.error("Токен отсутствует"),null)},oe=async()=>{try{const e=await s.A.get(G);a.value=e.data}catch(e){console.error("Ошибка при получении кейсов:",e)}},ie=async()=>{try{const e=await s.A.get("http://5.35.90.116:8000/prices");l.value=e.data}catch(e){console.error("Ошибка при получении цен:",e)}},ne=async()=>{try{const e=await s.A.get("http://5.35.90.116:8000/doctors");m.value=e.data}catch(e){console.error("Ошибка при получении докторов:",e)}},se=async e=>{const a=te();try{const l=await s.A.get(`${G}/${e}`,{headers:{Authorization:`Bearer ${a}`}});Y.value=l.data,Z.value=l.data.price.map((e=>e.id))}catch(l){console.error("Ошибка при получении кейса:",l)}},ue=e=>{se(e.id)},re=()=>{Y.value=null},ce=e=>{const a=e.target;if(a.files&&a.files.length>0){ae.value=a.files[0];const e=new FileReader;e.onload=e=>{ee.value=e.target?.result},e.readAsDataURL(ae.value)}},de=async()=>{const e=te();if(!ae.value)return null;const a=new FormData;a.append("path",ae.value),a.append("isTitle","false");try{const l=await s.A.post(O,a,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});return console.log("Изображение успешно загружено:",l.data),ee.value=null,l.data.id}catch(l){return console.error("Ошибка при загрузке изображения:",l),null}},me=async e=>{const a=te();if(a)try{const l=Y.value?.images||[];await Promise.all(l.map((async l=>{l.id!==e&&await s.A.patch(`http://5.35.90.116:8000/images/${l.id}`,{isTitle:!1},{headers:{Authorization:`Bearer ${a}`}})}))),await s.A.patch(`http://5.35.90.116:8000/images/${e}`,{isTitle:!0},{headers:{Authorization:`Bearer ${a}`}}),console.log(`Титульное изображение обновлено для ID: ${e}`)}catch(l){console.error("Ошибка при обновлении титульного изображения:",l)}},ve=async e=>{if(Y.value){const l=te();Y.value.images=Y.value.images.filter((a=>a.id!==e));try{await s.A.delete(`http://5.35.90.116:8000/images/${e}`,{headers:{Authorization:`Bearer ${l}`}})}catch(a){console.error("Ошибка при удалении изображения с сервера:",a)}}},ke=async()=>{const e=te();let a=null;if(ae.value&&(a=await de()),Y.value){const t={name:Y.value.name,category:Y.value.category,introduction:Y.value.introduction,diagnos:Y.value.diagnos,treatment:Y.value.treatment,totalCost:Y.value.totalCost,slug:Y.value.slug,doctor_id:Y.value.doctor?.id,price_id:Z.value,images_id:[...Y.value.images.map((e=>e.id)),a].filter(Boolean)};try{await s.A.put(`${G}/${Y.value.id}`,t,{headers:{Authorization:`Bearer ${e}`}}),console.log("Изменения успешно сохранены для кейса:",Y.value),re(),await oe()}catch(l){console.error("Ошибка при сохранении изменений:",l)}}},pe=async e=>{const a=te();try{await s.A.delete(`${G}/${e}`,{headers:{Authorization:`Bearer ${a}`}}),console.log(`Кейс с ID ${e} успешно удален`),await oe()}catch(l){console.error("Ошибка при удалении кейса:",l)}};return(0,t.sV)((()=>{oe(),ie(),ne()})),(e,s)=>((0,t.uX)(),(0,t.CE)("section",v,[(0,t.bF)((0,o.R1)(u.D),{tagName:"h2",size:"xl"},{default:(0,t.k6)((()=>[(0,t.eW)("Кейсы клиники")])),_:1}),k,(0,t.Lk)("div",p,[le.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)((0,o.R1)(r.$),{key:0,class:"results__add-button",tagName:"button",size:"xs",color:"green"},{default:(0,t.k6)((()=>[(0,t.eW)(" добавить новый кейс ")])),_:1})),Y.value?((0,t.uX)(),(0,t.CE)("form",g,[(0,t.Lk)("div",h,[f,(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Y.value.images,(e=>((0,t.uX)(),(0,t.CE)("li",{key:e.id},[(0,t.Lk)("img",{src:e.path,alt:"Case Image",style:{width:"100px",height:"auto"}},null,8,b),(0,t.Lk)("p",null,[(0,t.eW)("Сделать титульным "),(0,t.Lk)("input",{type:"checkbox",checked:e.isTitle,onChange:a=>me(e.id)},null,40,L)]),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"red",onClick:a=>ve(e.id)},{default:(0,t.k6)((()=>[(0,t.eW)("Удалить")])),_:2},1032,["onClick"])])))),128))]),(0,t.Lk)("div",y,[C,(0,t.Lk)("input",{type:"file",id:"image-upload",onChange:ce,accept:"image/*"},null,32),ee.value?((0,t.uX)(),(0,t.CE)("div",_,[w,(0,t.Lk)("img",{src:ee.value,alt:"Image Preview",style:{"max-width":"200px","max-height":"200px"}},null,8,$)])):(0,t.Q3)("",!0),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"accent",onClick:de,disabled:!ae.value},{default:(0,t.k6)((()=>[(0,t.eW)("Загрузить изображение")])),_:1},8,["disabled"])])]),(0,t.Lk)("div",x,[A,(0,t.bo)((0,t.Lk)("input",{id:"case-name","onUpdate:modelValue":s[0]||(s[0]=e=>Y.value.name=e)},null,512),[[i.Jo,Y.value.name]])]),(0,t.Lk)("div",R,[z,(0,t.bo)((0,t.Lk)("input",{id:"case-category","onUpdate:modelValue":s[1]||(s[1]=e=>Y.value.category=e)},null,512),[[i.Jo,Y.value.category]])]),(0,t.Lk)("div",F,[X,(0,t.bo)((0,t.Lk)("textarea",{id:"case-introduction","onUpdate:modelValue":s[2]||(s[2]=e=>Y.value.introduction=e)},null,512),[[i.Jo,Y.value.introduction]])]),(0,t.Lk)("div",E,[I,(0,t.bo)((0,t.Lk)("textarea",{id:"case-diagnos","onUpdate:modelValue":s[3]||(s[3]=e=>Y.value.diagnos=e)},null,512),[[i.Jo,Y.value.diagnos]])]),(0,t.Lk)("div",K,[U,(0,t.bo)((0,t.Lk)("textarea",{id:"case-treatment","onUpdate:modelValue":s[4]||(s[4]=e=>Y.value.treatment=e)},null,512),[[i.Jo,Y.value.treatment]])]),(0,t.Lk)("div",V,[W,(0,t.bo)((0,t.Lk)("input",{type:"number",id:"case-total-cost","onUpdate:modelValue":s[5]||(s[5]=e=>Y.value.totalCost=e)},null,512),[[i.Jo,Y.value.totalCost,void 0,{number:!0}]])]),(0,t.Lk)("div",N,[B,(0,t.bo)((0,t.Lk)("input",{id:"case-slug","onUpdate:modelValue":s[6]||(s[6]=e=>Y.value.slug=e)},null,512),[[i.Jo,Y.value.slug]])]),(0,t.Lk)("div",J,[D,(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":s[7]||(s[7]=e=>Y.value.doctor.id=e)},[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(m.value,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.firstName)+" "+(0,n.v_)(e.lastName),9,T)))),128))],512),[[i.u1,Y.value.doctor.id]])]),(0,t.Lk)("div",Q,[P,((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(l.value,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id},[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":s[8]||(s[8]=e=>Z.value=e)},null,8,S),[[i.lH,Z.value]]),(0,t.eW)(" "+(0,n.v_)(e.name)+" - "+(0,n.v_)(e.price),1)])))),128))]),(0,t.Lk)("div",j,[(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"green",onClick:ke},{default:(0,t.k6)((()=>[(0,t.eW)("Сохранить изменения")])),_:1}),(0,t.bF)((0,o.R1)(r.$),{tagName:"button",size:"xs",color:"white",onClick:re},{default:(0,t.k6)((()=>[(0,t.eW)("Отмена")])),_:1})])])):((0,t.uX)(),(0,t.CE)("ul",H,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.value,(e=>((0,t.uX)(),(0,t.CE)("li",{key:e.id,class:"case-item"},[(0,t.bF)((0,o.R1)(d.f),{tagName:"p",size:"xxl",color:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.name),1)])),_:2},1024),(0,t.Lk)("span",{onClick:a=>ue(e)},[(0,t.bF)((0,o.R1)(c.I),{type:"edit",color:"dark"})],8,M),(0,t.Lk)("span",{onClick:a=>pe(e.id)},[(0,t.bF)((0,o.R1)(c.I),{type:"delete",color:"red"})],8,q)])))),128))]))])]))}}),Z=l(6262);const ee=(0,Z.A)(Y,[["__scopeId","data-v-c4ad9526"]]);var ae=ee}}]);
//# sourceMappingURL=954.js.map